{% extends 'base.html' %} {% load static %} {% block title %}{{ page_title }}{%
endblock %} {% block extra_css %}
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  rel="stylesheet"
/>
<style>
  .sensor-card {
    border: none;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s;
  }
  .sensor-card:hover {
    transform: translateY(-2px);
  }
  .metric-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }
  .demo-banner {
    background: linear-gradient(45deg, #ff6b6b, #feca57);
    color: white;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
  }
</style>
{% endblock %} {% block content %}
<div class="container-fluid py-4">
  <!-- Demo Banner for Pitch -->
  <div class="demo-banner text-center">
    <h4>
      <i class="fas fa-rocket me-2"></i>HaloAI Demo - Smart Agriculture Platform
    </h4>
    <p class="mb-2">Bhairahawa-Butwal Region | Community Admin Dashboard</p>
    <small>Real-time IoT sensor monitoring for precision agriculture</small>
  </div>

  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-md-8">
      <h1 class="h3 mb-1">{{ page_title|default:"IoT Sensor Dashboard" }}</h1>
      <p class="text-muted">
        <i class="fas fa-map-marker-alt me-1"></i>{{
        region|default:"Bhairahawa-Butwal" }}
        <span class="badge bg-success ms-2">
          {% if user.role == 'community_admin' %}Community Admin{% else %}System
          Admin{% endif %}
        </span>
      </p>
    </div>
    <div class="col-md-4 text-end">
      <a href="{% url 'crops:dashboard' %}" class="btn btn-success">
        <i class="fas fa-seedling me-1"></i>Crop Predictions
      </a>
      <a
        href="{% url 'users:community_dashboard' %}"
        class="btn btn-outline-primary ms-2"
      >
        <i class="fas fa-chart-bar me-1"></i>Dashboard
      </a>
    </div>
  </div>

  <!-- Metrics Row -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card metric-card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h5 class="card-title">{{ total_sensors|default:3 }}</h5>
              <p class="card-text">Total Sensors</p>
            </div>
            <i class="fas fa-microchip fa-2x opacity-75"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card metric-card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h5 class="card-title">{{ active_sensors|default:2 }}</h5>
              <p class="card-text">Active Sensors</p>
            </div>
            <i class="fas fa-wifi fa-2x opacity-75"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card metric-card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h5 class="card-title">
                {{ regional_analytics.prediction_count|default:5 }}
              </h5>
              <p class="card-text">Predictions</p>
            </div>
            <i class="fas fa-seedling fa-2x opacity-75"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card metric-card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h5 class="card-title">{{ alerts|length|default:1 }}</h5>
              <p class="card-text">Alerts</p>
            </div>
            <i class="fas fa-exclamation-triangle fa-2x opacity-75"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Row -->
  <div class="row">
    <!-- Sensors Column -->
    <div class="col-md-8">
      <div class="card">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0">
            <i class="fas fa-satellite-dish me-2"></i>My Sensor Sets
          </h5>
          <span class="badge bg-primary">Live Demo Data</span>
        </div>
        <div class="card-body">
          {% if managed_sensors %} {% for sensor in managed_sensors %}
          <div class="card sensor-card mb-3">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-6">
                  <h6 class="mb-1">{{ sensor.name }}</h6>
                  <p class="text-muted mb-1">
                    <i class="fas fa-map-marker-alt me-1"></i>{{
                    sensor.location_name }}
                  </p>
                  <span
                    class="badge {% if sensor.status == 'active' %}bg-success{% else %}bg-warning{% endif %}"
                  >
                    {{ sensor.get_status_display }}
                  </span>
                </div>
                <div class="col-md-3">
                  <small class="text-muted">Last Updated</small>
                  <p class="mb-0">{{ sensor.updated_at|date:"M d, H:i" }}</p>
                </div>
                <div class="col-md-3 text-end">
                  <a
                    href="{% url 'crops:dashboard' %}"
                    class="btn btn-sm btn-success"
                  >
                    <i class="fas fa-seedling me-1"></i>Predict Crops
                  </a>
                </div>
              </div>
            </div>
          </div>
          {% endfor %} {% else %}
          <!-- Demo sensor sets for pitch -->
          <div class="card sensor-card mb-3">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-6">
                  <h6 class="mb-1">Sensor Set A</h6>
                  <p class="text-muted mb-1">
                    <i class="fas fa-map-marker-alt me-1"></i>Wheat Field -
                    North Block
                  </p>
                  <span class="badge bg-success">Active</span>
                  <span class="badge bg-info ms-1">Temperature: 25.5°C</span>
                </div>
                <div class="col-md-3">
                  <small class="text-muted">Last Updated</small>
                  <p class="mb-0">2 min ago</p>
                </div>
                <div class="col-md-3 text-end">
                  <a
                    href="{% url 'crops:dashboard' %}"
                    class="btn btn-sm btn-success"
                  >
                    <i class="fas fa-seedling me-1"></i>Predict Crops
                  </a>
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-md-12">
                  <small class="text-muted">Real-time readings:</small>
                  <div class="d-flex gap-3 mt-1">
                    <span class="badge bg-light text-dark">Humidity: 65%</span>
                    <span class="badge bg-light text-dark">pH: 6.8</span>
                    <span class="badge bg-light text-dark">NPK: 85/50/40</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card sensor-card mb-3">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-6">
                  <h6 class="mb-1">Sensor Set B</h6>
                  <p class="text-muted mb-1">
                    <i class="fas fa-map-marker-alt me-1"></i>Rice Field - South
                    Block
                  </p>
                  <span class="badge bg-success">Active</span>
                  <span class="badge bg-info ms-1">Temperature: 28.2°C</span>
                </div>
                <div class="col-md-3">
                  <small class="text-muted">Last Updated</small>
                  <p class="mb-0">5 min ago</p>
                </div>
                <div class="col-md-3 text-end">
                  <a
                    href="{% url 'crops:dashboard' %}"
                    class="btn btn-sm btn-success"
                  >
                    <i class="fas fa-seedling me-1"></i>Predict Crops
                  </a>
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-md-12">
                  <small class="text-muted">Real-time readings:</small>
                  <div class="d-flex gap-3 mt-1">
                    <span class="badge bg-light text-dark">Humidity: 78%</span>
                    <span class="badge bg-light text-dark">pH: 7.2</span>
                    <span class="badge bg-light text-dark">NPK: 85/50/40</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card sensor-card mb-3" style="opacity: 0.7">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-6">
                  <h6 class="mb-1">Sensor Set C</h6>
                  <p class="text-muted mb-1">
                    <i class="fas fa-map-marker-alt me-1"></i>Maize Field - East
                    Block
                  </p>
                  <span class="badge bg-warning">Maintenance</span>
                </div>
                <div class="col-md-3">
                  <small class="text-muted">Last Updated</small>
                  <p class="mb-0">2 hours ago</p>
                </div>
                <div class="col-md-3 text-end">
                  <button class="btn btn-sm btn-outline-secondary" disabled>
                    <i class="fas fa-tools me-1"></i>Maintenance
                  </button>
                </div>
              </div>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Sidebar Column -->
    <div class="col-md-4">
      <!-- Quick Actions -->
      <div class="card mb-4">
        <div class="card-header">
          <h6 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <a href="{% url 'crops:dashboard' %}" class="btn btn-success">
              <i class="fas fa-seedling me-1"></i>View Crop Predictions
            </a>
            <a
              href="{% url 'users:community_dashboard' %}"
              class="btn btn-info"
            >
              <i class="fas fa-users me-1"></i>Farmer Management
            </a>
            <button class="btn btn-warning" onclick="simulateAlert()">
              <i class="fas fa-bell me-1"></i>Test Alert System
            </button>
          </div>
        </div>
      </div>

      <!-- Regional Information -->
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="fas fa-map me-2"></i>Bhairahawa-Butwal Region
          </h6>
        </div>
        <div class="card-body">
          <p><strong>Focus:</strong> Precision Agriculture</p>
          <p><strong>Main Crops:</strong> Wheat, Rice, Maize, Sugarcane</p>
          <p><strong>Climate:</strong> Subtropical</p>
          <p><strong>Soil:</strong> Alluvial, High Fertility</p>

          <hr />
          <h6>Default NPK Values (MVP)</h6>
          <ul class="list-unstyled">
            <li><strong>Nitrogen:</strong> 85.0 kg/ha</li>
            <li><strong>Phosphorus:</strong> 50.0 kg/ha</li>
            <li><strong>Potassium:</strong> 40.0 kg/ha</li>
          </ul>

          <div class="alert alert-info mt-3">
            <small>
              <i class="fas fa-info-circle me-1"></i>
              NPK sensors coming in Phase 2. Using regional research data for
              MVP.
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function simulateAlert() {
    alert(
      "🚨 Alert Simulation:\n\nSensor Set A - Wheat Field\n• Low soil moisture detected\n• Temperature rising above optimal\n• Immediate irrigation recommended\n\nThis demonstrates real-time monitoring capabilities."
    );
  }

  // Simulate real-time updates for demo
  let updateCounter = 0;
  setInterval(function () {
    updateCounter++;
    const badges = document.querySelectorAll(".badge.bg-info");
    badges.forEach((badge) => {
      if (badge.textContent.includes("Temperature")) {
        const temp = (25.5 + Math.sin(updateCounter * 0.1) * 2).toFixed(1);
        badge.textContent = `Temperature: ${temp}°C`;
      }
    });
  }, 3000);

  // Show pitch-friendly welcome message
  setTimeout(function () {
    const welcomeMsg = `
        🌾 Welcome to HaloAI Smart Agriculture Platform!
        
        This dashboard shows real-time IoT sensor data for the Bhairahawa-Butwal region.
        
        Key Features Demonstrated:
        ✅ Role-based access control
        ✅ Real-time sensor monitoring
        ✅ Regional crop recommendations
        ✅ ML-powered predictions
        ✅ Community admin management
        
        Click "View Crop Predictions" to see ML recommendations!
        `;

    if (confirm(welcomeMsg)) {
      window.location.href = "{% url 'crops:dashboard' %}";
    }
  }, 1000);
</script>
{% endblock %}
